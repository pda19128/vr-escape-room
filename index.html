<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8">
  <title>VR Escape Room - Time Lab</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>

  <style>
    #overlay {
      position: fixed;
      inset: 0;
      display: none;
      justify-content: center;
      align-items: center;
      background: black;
      color: #00ffcc;
      font-size: 3rem;
      font-family: Arial, sans-serif;
      z-index: 9999;
      text-align: center;
    }
  </style>
</head>

<body>

<div id="overlay">ΔΙΕΦΥΓΕΣ ΕΠΙΤΥΧΩΣ!</div>

<a-scene background="color: #050505"
         cursor="rayOrigin: mouse"
         raycaster="objects: .clickable">

  <!-- ΚΑΜΕΡΑ -->
  <a-entity id="cameraRig" position="0 1.6 4" scale="1 1 1">
    <a-camera></a-camera>
  </a-entity>

  <!-- ================= ROOM 1 ================= -->
  <a-light type="ambient" intensity="0.15"></a-light>
  <a-light type="point" position="0 3 2" intensity="0.6" color="#00ffff"></a-light>
  <a-light id="panelLight" type="point" position="4.8 2 2" intensity="0" color="#00ffcc"></a-light>

  <a-plane rotation="-90 0 0" width="10" height="10" color="#444"></a-plane>
  <a-box position="0 2 -5" width="10" height="4" depth="0.2" color="#222"></a-box>
  <a-box position="-5 2 0" width="0.2" height="4" depth="10" color="#222"></a-box>
  <a-box position="5 2 0" width="0.2" height="4" depth="10" color="#222"></a-box>

  <a-box class="cube clickable" data-correct="false" position="-2 1 -3"
         width="0.5" height="0.5" depth="0.5" color="#880000"
         animation__shake="property: position; dur: 80; dir: alternate; loop: 6; to: -1.95 1 -3; startEvents: shake"></a-box>

  <a-box class="cube clickable" data-correct="true" position="0 1 -3"
         width="0.5" height="0.5" depth="0.5" color="#880000"
         animation__shake="property: position; dur: 80; dir: alternate; loop: 6; to: 0.05 1 -3; startEvents: shake"></a-box>

  <a-box class="cube clickable" data-correct="false" position="2 1 -3"
         width="0.5" height="0.5" depth="0.5" color="#880000"
         animation__shake="property: position; dur: 80; dir: alternate; loop: 6; to: 2.05 1 -3; startEvents: shake"></a-box>

  <a-box id="panel" class="clickable" position="4.8 1.4 2"
         rotation="0 -90 0" width="1" height="0.5" depth="0.2"
         color="#555" visible="false"></a-box>

  <a-torus id="portal" position="0 2.3 -4.5"
           radius="0.7" radius-tubular="0.12"
           color="#00ffff" visible="false"
           animation__rotate="property: rotation; to: 0 360 0; dur: 4000; loop: true; startEvents: activate"></a-torus>

  <!-- ================= ROOM 2 ================= -->
  <a-entity id="room2" visible="false">

    <a-light type="ambient" intensity="0.6"></a-light>
    <a-light type="point" position="0 4 -20" intensity="1.2"></a-light>

    <a-plane position="0 0 -20" rotation="-90 0 0" width="12" height="12" color="#888"></a-plane>
    <a-box position="0 2 -26" width="12" height="4" depth="0.2" color="#aaa"></a-box>

    <!-- ΚΥΒΟΙ -->
    <a-box class="cube2 clickable" position="-3 1 -18"></a-box>
    <a-box class="cube2 clickable" position="0 1 -21"></a-box>
    <a-box class="cube2 clickable" position="3 1 -19"></a-box>
    <a-box class="cube2 clickable" position="-2 1 -23"></a-box>
    <a-box class="cube2 clickable" position="2 1 -24"></a-box>
    <a-box class="cube2 clickable" position="0 1 -22"></a-box>

    <!-- ΤΕΛΙΚΗ ΠΥΛΗ (ΠΙΟ ΜΠΡΟΣΤΑ) -->
    <a-torus id="finalPortal" position="0 2.5 -23"
             radius="0.9" radius-tubular="0.15"
             color="#00ffcc" visible="false"
             animation__rotate="property: rotation; to: 0 360 0; dur: 3500; loop: true; startEvents: activate"></a-torus>

  </a-entity>

</a-scene>

<script>
let cubeSolved = false;
const cameraRig = document.querySelector('#cameraRig');

/* ROOM 1 */
document.querySelectorAll('.cube').forEach(cube => {
  cube.addEventListener('click', () => {
    if (cubeSolved) return;
    if (cube.dataset.correct === "true") {
      cubeSolved = true;
      cube.setAttribute('color', 'green');
      document.querySelector('#panel').setAttribute('visible', 'true');
      document.querySelector('#panelLight').setAttribute('intensity', '1.2');
    } else cube.emit('shake');
  });
});

document.querySelector('#panel').addEventListener('click', () => {
  document.querySelector('#portal').setAttribute('visible', 'true');
  document.querySelector('#portal').emit('activate');

  cameraRig.setAttribute('animation', {
    property: 'position',
    to: '0 1.6 -18',
    dur: 3000,
    easing: 'easeInOutQuad'
  });

  setTimeout(() => {
    document.querySelector('#room2').setAttribute('visible', 'true');
  }, 3000);
});

/* ROOM 2 */
let room2Solved = false;
const cubes2 = document.querySelectorAll('.cube2');
const finalPortal = document.querySelector('#finalPortal');

cubes2.forEach(cube => {
  cube.setAttribute('width', '0.5');
  cube.setAttribute('height', '0.5');
  cube.setAttribute('depth', '0.5');
  cube.setAttribute('color', '#880000');
  cube.setAttribute(
    'animation__shake',
    'property: rotation; dur: 80; dir: alternate; loop: 6; to: 2 0 2; startEvents: shake'
  );
});

cubes2[Math.floor(Math.random() * cubes2.length)].dataset.correct = "true";

cubes2.forEach(cube => {
  cube.addEventListener('click', () => {
    if (room2Solved) return;

    if (cube.dataset.correct === "true") {
      room2Solved = true;
      cube.setAttribute('color', 'green');

      finalPortal.setAttribute('visible', 'true');
      finalPortal.emit('activate');

      // στάση μπροστά στην πύλη
      cameraRig.setAttribute('animation__approach', {
        property: 'position',
        to: '0 1.8 -21.5',
        dur: 1200,
        easing: 'easeOutQuad'
      });

      // ρούφηγμα
      setTimeout(() => {
        cameraRig.setAttribute('animation__suck', {
          property: 'position',
          to: '0 2.5 -23',
          dur: 1500,
          easing: 'easeInQuad'
        });
        cameraRig.setAttribute('animation__scale', {
          property: 'scale',
          to: '0.05 0.05 0.05',
          dur: 1500,
          easing: 'easeInQuad'
        });
      }, 1200);

      setTimeout(() => {
        document.querySelector('#overlay').style.display = 'flex';
      }, 2800);

    } else cube.emit('shake');
  });
});
</script>

</body>
</html>
